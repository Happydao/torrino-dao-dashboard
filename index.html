<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Torrino DAO NFT Dashboard</title>

  <!-- Typography -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet" />

  <style>
    :root{
      --bg:#070a12;
      --bg-2:#0b1220;
      --panel: rgba(17,24,39,.55);
      --panel-strong: rgba(17,24,39,.75);
      --border: rgba(255,255,255,.22); /* stronger */
      --txt:#e7e9ee;
      --muted:#a1a8b3;
      --primary:#00e0ff;   /* neon cyan */
      --secondary:#a855f7; /* violet */
      --accent:#00ffa3;    /* solana green */
      --warning:#ffcc00;
      --success:#00d38d;
      --danger:#ff5c7a;
      --radius:18px;
      --shadow: 0 14px 36px rgba(0,0,0,.45), 0 0 0 2px var(--border) inset; /* thicker outline */
      --outline: 2px; /* card borders more accentuated */
    }

    *{ box-sizing: border-box }
    html,body{ height:100% }

    body{
      margin:0;
      font-family: 'Inter', system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color: var(--txt);
      background:
        radial-gradient(1200px 600px at 100% -10%, rgba(168,85,247,.18), transparent 60%),
        radial-gradient(800px 400px at -10% 20%, rgba(0,255,163,.12), transparent 60%),
        linear-gradient(180deg, var(--bg), var(--bg-2));
      overflow-x:hidden;
      letter-spacing:.2px;
    }

    .backgrid{ position: fixed; inset: 0; pointer-events:none; z-index:0;
      background-image:
        linear-gradient(rgba(255,255,255,.03) 1px, transparent 1px),
        linear-gradient(90deg, rgba(255,255,255,.03) 1px, transparent 1px);
      background-size: 22px 22px, 22px 22px;
      mask-image: radial-gradient(1200px 600px at 50% -10%, rgba(0,0,0,.7), transparent 75%);
    }

    .wrapper{ position: relative; z-index:1; max-width:1200px; margin: 36px auto 80px; padding: 0 18px; }

    /* Header */
    .header{ display:flex; align-items:center; justify-content:space-between; gap:16px; margin-bottom: 20px; }

    .brand{ display:flex; align-items:center; gap:14px; }
    .brand img{
      width:64px; height:auto; object-fit:contain; display:block;
      border-radius:0; /* FIX: no rounding => no clipping */
      filter: drop-shadow(0 6px 18px rgba(0,224,255,.25));
    }
    .brand .title{ display:flex; flex-direction:column; }
    .brand h1{ margin:0; font-size: clamp(20px, 3.2vw, 28px); font-weight:800; letter-spacing:.3px;
      background: linear-gradient(90deg, var(--primary), var(--secondary), var(--accent));
      -webkit-background-clip: text; background-clip: text; color: transparent; }
    .brand small{ color: var(--muted); margin-top:2px; font-weight:500; }

    .top-links{ display:flex; align-items:center; flex-wrap:wrap; gap:10px; }
    .chip, .icon-btn{
      display:inline-flex; align-items:center; gap:8px; padding:10px 12px; text-decoration:none; color: var(--txt);
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border: var(--outline) solid var(--border); border-radius: 14px; box-shadow: var(--shadow);
      transition: transform .15s ease, border-color .2s ease, box-shadow .2s ease, background .2s ease;
      backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(8px); font-weight:600; font-size: 14px;
    }
    .chip:hover, .icon-btn:hover{ transform: translateY(-1px); border-color: rgba(255,255,255,.28);
      box-shadow: 0 12px 30px rgba(0,224,255,.12), 0 0 0 2px rgba(255,255,255,.12) inset; }
    .icon-btn{ width:42px; height:42px; padding:0; justify-content:center; }
    .icon-btn img{ width:20px; height:20px; filter: saturate(1.1) brightness(1.05) }

    /* Panels & sections */
    .section{
      padding: 18px; border-radius: var(--radius);
      background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.035));
      border: var(--outline) solid var(--border); box-shadow: var(--shadow);
      backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); margin-top:18px;
    }
    .section h2{ margin: 4px 0 14px; font-size: clamp(18px, 2.2vw, 22px); font-weight:800; letter-spacing:.2px; }
    .eyebrow{ display:inline-flex; align-items:center; gap:8px; font-size:12px; font-weight:700; text-transform:uppercase; letter-spacing:.18em; color: var(--accent); }

    /* Stats grid */
    .stat-grid{ display:grid; gap:12px; grid-template-columns: repeat(12, 1fr); }
    .stat{ grid-column: span 12; padding:16px; border-radius: 16px; border:var(--outline) solid var(--border);
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03)); position:relative; overflow:visible; box-shadow: var(--shadow); }
    .stat .label{ color: var(--muted); font-size:12px; font-weight:700; letter-spacing:.06em; text-transform:uppercase; }
    .stat .value{ margin-top:6px; font-family: 'JetBrains Mono', ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; font-weight:800; font-size: clamp(18px, 3vw, 26px); line-height:1.25; word-wrap:anywhere; }
    .stat .sub{ margin-top:6px; color: var(--muted); font-size:12px; }

    /* Small/muted stats */
    .stat.muted .label{ font-size:11px; opacity:.8 }
    .stat.muted .value{ font-size: clamp(14px, 2.2vw, 18px); font-weight:700; color: var(--muted); }

    /* Responsive columns for stats */
    @media (min-width: 640px){ .stat.x3 { grid-column: span 4; } .stat.x2 { grid-column: span 6; } .stat.x1 { grid-column: span 12; } }
    @media (min-width: 980px){ .stat.x3 { grid-column: span 3; } .stat.x2 { grid-column: span 6; } .stat.x1 { grid-column: span 12; } }

    /* Discounts & buttons */
    .buy-actions{ display:flex; flex-wrap:wrap; gap:10px; margin-top:12px; }
    .btn{ appearance:none; border:none; cursor:pointer; font-weight:800; letter-spacing:.2px; padding:12px 16px; border-radius:12px;
      background: linear-gradient(90deg, var(--primary), var(--accent)); color:#0b1220; box-shadow: 0 10px 26px rgba(0,224,255,.22);
      text-decoration:none; display:inline-flex; align-items:center; gap:8px; transition: transform .12s ease, filter .12s ease, box-shadow .12s ease; }
    .btn:hover{ transform: translateY(-1px); filter:brightness(1.02) }

    .note{ color: var(--muted); font-size: 14px; line-height:1.6; }
    .highlight{ color: var(--warning); font-weight:700 }

    /* Charts grid */
    .charts{ display:grid; gap:12px; margin-top:8px; grid-template-columns: 1fr; }
    @media (min-width: 980px){ .charts{ grid-template-columns: 1fr 1fr; } .charts .chart.full{ grid-column: 1 / -1; } }
    .chart{ border:var(--outline) solid var(--border); border-radius:16px; overflow:hidden; background: #0e1526; box-shadow: var(--shadow); }
    .chart iframe{ display:block; width:100%; height:440px; border:0 }
    .chart.centered{ display:flex; justify-content:center; }
    .chart.centered iframe{ max-width: 980px; margin: 0 auto; }

    /* Update/footnote */
    .footnote{ margin-top: 8px; font-size: 12px; color: var(--muted); display:flex; flex-wrap:wrap; gap:16px; }

    /* Skeleton loading */
    .skeleton{ position: relative; background: linear-gradient(90deg, rgba(255,255,255,.08), rgba(255,255,255,.04), rgba(255,255,255,.08)); background-size: 200% 100%; animation: shine 1.1s linear infinite; color: transparent !important; border-radius: 8px; display:inline-block; line-height:1.1; }
    @keyframes shine{ 0% { background-position: 200% 0 } 100% { background-position: -200% 0 } }

    /* Two-up grid helper */
    .row{ display:grid; gap:12px; grid-template-columns:1fr; }
    @media(min-width: 900px){ .row{ grid-template-columns: 1fr 1fr } }

    a{ color: var(--primary) }

    /* ==== MINI PIE CHARTS ==== */
    .mini-pie{ display:flex; align-items:center; gap:14px; padding:12px; border-radius:14px; border:var(--outline) solid var(--border); box-shadow: var(--shadow);
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03)); }
    .pie{ width:92px; height:92px; border-radius:50%; position:relative; flex:0 0 auto; background:#0b1220; }
    .pie::after{ content:attr(data-label); position:absolute; inset:12px; border-radius:50%; background:#0e1526; display:flex; align-items:center; justify-content:center; font-size:12px; color:var(--muted); font-weight:700; text-align:center; padding:4px; }
    .legend{ display:flex; flex-direction:column; gap:6px; font-size:13px; }
    .legend b{ font-weight:800 }
    .badge{ display:inline-flex; align-items:center; gap:6px; }
    .dot{ width:10px; height:10px; border-radius:50%; display:inline-block; }

    /* Footer */
    footer{ text-align:center }
    footer small{ color: var(--muted) }
  </style>
</head>
<body>
  <div class="backgrid" aria-hidden="true"></div>

  <div class="wrapper">
    <!-- HEADER -->
    <header class="header">
      <div class="brand">
        <img src="torrino-dao.png" alt="Torrino DAO Logo" />
        <div class="title">
          <h1>Torrino DAO ‚Äî NFT Dashboard</h1>
          <small>On-chain analytics ‚Ä¢ NFTs ‚Ä¢ Treasury</small>
        </div>
      </div>

      <nav class="top-links">
        <a class="icon-btn" href="https://github.com/Happydao/torrino-dao-dashboard" target="_blank" aria-label="GitHub">
          <img src="https://cdn-icons-png.flaticon.com/512/733/733553.png" alt="GitHub" />
        </a>
        <a class="icon-btn" href="https://discord.gg/yYkwEjcKa9" target="_blank" aria-label="Discord">
          <img src="https://cdn-icons-png.flaticon.com/512/3670/3670157.png" alt="Discord" />
        </a>
        <a class="icon-btn" href="https://twitter.com/Torrino_DAO" target="_blank" aria-label="Twitter (X)">
          <img src="https://cdn-icons-png.flaticon.com/512/5968/5968958.png" alt="Twitter (X)" />
        </a>
        <a class="chip" href="https://jup.ag/portfolio/EKjb5grMX19c3cAZa5LQjqksDpqqVLTGZrswh79WkPdD" target="_blank" rel="noopener">
          üíº Jupiter Treasury
        </a>
      </nav>
    </header>

    <!-- TOP STATS -->
    <section class="section" aria-labelledby="overview">
      <div class="eyebrow">Overview</div>
      <h2 id="overview">Treasury &amp; Market</h2>

      <div class="stat-grid" role="list">
        <div class="stat x3" role="listitem">
          <div class="label">Total Treasury</div>
          <div class="value" id="treasuryValue"><span class="skeleton">&nbsp;&nbsp;&nbsp;&nbsp;</span></div>
        </div>

        <div class="stat x3" role="listitem">
          <div class="label">Stable Protected Capital</div>
          <div class="value"><span id="stableValue"><span class="skeleton">&nbsp;&nbsp;&nbsp;&nbsp;</span></span></div>
          <div class="sub">= <span id="stablePercentage"><span class="skeleton">&nbsp;</span></span>% of treasury</div>
        </div>

        <div class="stat x3" role="listitem">
          <div class="label">Gen 1 Treasury (90%)</div>
          <div class="value" id="treasuryGen1"><span class="skeleton">&nbsp;&nbsp;&nbsp;</span></div>
        </div>

        <div class="stat x3" role="listitem">
          <div class="label">Gen 2 Treasury (10%)</div>
          <div class="value" id="treasuryGen2"><span class="skeleton">&nbsp;&nbsp;&nbsp;</span></div>
        </div>

        <!-- REPLACED spots: instead of SOL & Last Updated, show the two pies stacked (x1 full-width) -->
        <div class="stat x1" role="listitem">
          <div class="label">Treasury Breakdown (Stable vs Invested)</div>
          <div class="mini-pie" style="margin-top:10px">
            <div class="pie" id="pieStable" data-label="Stable"></div>
            <div class="legend">
              <b>Breakdown</b>
              <div class="badge"><span class="dot" style="background:var(--accent)"></span> Stable Coins <span id="legendStable" style="margin-left:6px; font-weight:700"></span></div>
              <div class="badge"><span class="dot" style="background:var(--secondary)"></span> Invested / Volatile <span id="legendInvested" style="margin-left:6px; font-weight:700"></span></div>
            </div>
          </div>
        </div>

        <div class="stat x1" role="listitem">
          <div class="label">Treasury by Generation (Value)</div>
          <div class="mini-pie" style="margin-top:10px">
            <div class="pie" id="pieGen" data-label="Gen 1"></div>
            <div class="legend">
              <b>Value Allocation</b>
              <div class="badge"><span class="dot" style="background:var(--primary)"></span> Gen 1 share <span id="legendGen1" style="margin-left:6px; font-weight:700"></span></div>
              <div class="badge"><span class="dot" style="background:var(--danger)"></span> Gen 2 share <span id="legendGen2" style="margin-left:6px; font-weight:700"></span></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Footnote moved below: small SOL price & last update -->
      <div class="footnote">
        <div>Current SOL Price: <strong id="footSol"><span class="skeleton">&nbsp;</span></strong></div>
        <div>Last updated: <strong id="footUpdated"><span class="skeleton">&nbsp;</span></strong></div>
      </div>
    </section>

    <!-- NFT REAL VALUE -->
    <section class="section" aria-labelledby="nft-values">
      <div class="eyebrow">NFT</div>
      <h2 id="nft-values">Current NFT Real Value</h2>

      <div class="row">
        <div>
          <div class="stat">
            <div class="label">Torrino DAO (Gen 1 ‚Äî 500 pcs)</div>
            <div class="value">
              <span id="nftGen1Value"><span class="skeleton">&nbsp;&nbsp;</span></span>
              <span class="sub">(<span id="nftGen1ValueSol"><span class="skeleton">&nbsp;</span></span>)</span>
            </div>
          </div>
        </div>
        <div>
          <div class="stat">
            <div class="label">Solnauta (Gen 2 ‚Äî 888 pcs)</div>
            <div class="value">
              <span id="nftGen2Value"><span class="skeleton">&nbsp;&nbsp;</span></span>
              <span class="sub">(<span id="nftGen2ValueSol"><span class="skeleton">&nbsp;</span></span>)</span>
            </div>
          </div>
        </div>
      </div>

      <p class="note" style="margin-top:12px">
        <strong>üì¢ NFT Discount Analysis:</strong><br/>
        Listing prices are compared with the NFT <em>real value</em> based on the treasury. If the listing price is lower than the real value, the NFT is considered discounted and may be a better entry versus the current treasury valuation.
      </p>

      <p class="note">
        <strong>üí° Protected Capital &amp; NFT Value:</strong><br/>
        <em>Protected Capital</em> is the slice of the treasury held in stables (USDC/USDT/USDY) that preserves value regardless of market conditions. Buying a discounted NFT gives exposure to both the volatile part and the protected portion of the treasury: <span class="highlight">high discount + high protected %</span> = upside potential + capital preservation.
      </p>
    </section>

    <!-- DISCOUNTS -->
    <section class="section" aria-labelledby="discounts">
      <div class="eyebrow">Market</div>
      <h2 id="discounts">Discounts on Listed NFTs</h2>

      <div class="row">
        <div>
          <div class="stat">
            <div class="label">üìâ Torrino DAO (Gen 1)</div>
            <div class="value">
              <span id="gen1ListingPrice"><span class="skeleton">&nbsp;&nbsp;</span></span>
            </div>
            <div class="sub">‚û°Ô∏è Difference from real value: <strong><span id="gen1Discount"><span class="skeleton">&nbsp;</span></span>%</strong></div>
            <div class="buy-actions">
              <a class="btn" href="https://www.tensor.trade/trade/torrino_dao" target="_blank" rel="noopener">üõí Buy Torrino DAO</a>
            </div>
          </div>
        </div>

        <div>
          <div class="stat">
            <div class="label">üìâ Solnauta (Gen 2)</div>
            <div class="value">
              <span id="gen2ListingPrice"><span class="skeleton">&nbsp;&nbsp;</span></span>
            </div>
            <div class="sub">‚û°Ô∏è Difference from real value: <strong><span id="gen2Discount"><span class="skeleton">&nbsp;</span></span>%</strong></div>
            <div class="buy-actions">
              <a class="btn" href="https://www.tensor.trade/trade/solnauta" target="_blank" rel="noopener">üõí Buy Solnauta</a>
            </div>
          </div>
        </div>
      </div>

      <div class="footnote">Data source last updated: <strong id="marketUpdated"><span class="skeleton">&nbsp;</span></strong></div>
    </section>

    <!-- CHARTS -->
    <section class="section" aria-labelledby="charts">
      <div class="eyebrow">Analytics</div>
      <h2 id="charts">Treasury Charts</h2>

      <div class="charts">
        <div class="chart">
          <iframe
            src="https://docs.google.com/spreadsheets/d/e/2PACX-1vT84K0e8A5H3P2gI4upLGkArVFHDtXQ5uyDAfZjEHfnYsxGm0uCHwUxfTHr_zzm4jkzhUGMzdox85DT/pubchart?oid=908001184&format=interactive"
            loading="lazy" referrerpolicy="no-referrer" title="Treasury Chart 1">
          </iframe>
        </div>

        <div class="chart">
          <iframe
            src="https://docs.google.com/spreadsheets/d/e/2PACX-1vT84K0e8A5H3P2gI4upLGkArVFHDtXQ5uyDAfZjEHfnYsxGm0uCHwUxfTHr_zzm4jkzhUGMzdox85DT/pubchart?oid=1345237562&format=interactive"
            loading="lazy" referrerpolicy="no-referrer" title="Treasury Chart 2">
          </iframe>
        </div>

        <div class="chart full centered">
          <iframe
            src="https://docs.google.com/spreadsheets/d/e/2PACX-1vT84K0e8A5H3P2gI4upLGkArVFHDtXQ5uyDAfZjEHfnYsxGm0uCHwUxfTHr_zzm4jkzhUGMzdox85DT/pubchart?oid=1508575723&amp;format=interactive"
            loading="lazy" referrerpolicy="no-referrer" title="Treasury Table / Chart 3">
          </iframe>
        </div>
      </div>
    </section>

    <footer class="section">
      <small>¬© 2025 Torrino DAO</small>
    </footer>
  </div>

  <script>
    // ===== Formatting helpers =====
    // Top stats: show thousands with commas AND explicit currency to avoid confusion
    const fmtUsdBig = (v) => {
      const num = Number(v);
      if (isNaN(num)) return String(v);
      const opts = Number.isInteger(num) ? { maximumFractionDigits: 0 } : { maximumFractionDigits: 2 };
      return "$" + num.toLocaleString("en-US", opts) + " USD";
    };
    // NFT/Market sections: no grouping (plain), keep up to 2 decimals
    const fmtUsdPlain = (v) => {
      const num = Number(v);
      if (isNaN(num)) return String(v);
      return "$" + num.toFixed(Number.isInteger(num) ? 0 : 2).replace(/\.00$/, "");
    };
    const fmtNoGroup = (v) => {
      const num = Number(v);
      if (isNaN(num)) return String(v);
      return num.toFixed(Number.isInteger(num) ? 0 : 2).replace(/\.00$/, "");
    };
    const setText = (id, val) => {
      const el = document.getElementById(id);
      if (!el) return; el.textContent = val; el.classList?.remove('skeleton');
    };

    // ===== Mini pie helpers (CSS conic-gradient) =====
    function setPie(el, pct, colorA, colorB, label){
      if(!el) return;
      const p = Math.max(0, Math.min(100, Number(pct) || 0));
      el.style.background = `conic-gradient(${colorA} 0 ${p}%, ${colorB} 0 ${100}%)`;
      if(label) el.setAttribute('data-label', label);
    }

    async function fetchNFTData() {
      try {
        const res = await fetch('data.json', { cache: 'no-store' });
        const data = await res.json();

        // ===== Top stats =====
        setText('treasuryValue', fmtUsdBig(data.treasuryValue));
        setText('stableValue', fmtUsdBig(data.stableValue));
        const stablePct = Number(data.stablePercentage ?? (Number(data.stableValue)/Number(data.treasuryValue)*100));
        setText('stablePercentage', isFinite(stablePct) ? stablePct.toFixed(0) : '‚Äî');

        setText('treasuryGen1', fmtUsdBig(data.treasuryGen1));
        setText('treasuryGen2', fmtUsdBig(data.treasuryGen2));

        // ===== NFT values (no grouping) =====
        setText('nftGen1Value', fmtUsdPlain(data.nftGen1Value));
        setText('nftGen1ValueSol', `${fmtNoGroup(data.nftGen1ValueSol)} SOL`);
        setText('nftGen2Value', fmtUsdPlain(data.nftGen2Value));
        setText('nftGen2ValueSol', `${fmtNoGroup(data.nftGen2ValueSol)} SOL`);

        // ===== Discounts / listings (no grouping) =====
        setText('gen1ListingPrice', `${fmtUsdPlain(data.gen1ListingPrice)} (${fmtNoGroup(data.gen1ListingPriceSol)} SOL)`);
        setText('gen1Discount', fmtNoGroup(data.gen1Discount));
        setText('gen2ListingPrice', `${fmtUsdPlain(data.gen2ListingPrice)} (${fmtNoGroup(data.gen2ListingPriceSol)} SOL)`);
        setText('gen2Discount', fmtNoGroup(data.gen2Discount));

        // ===== Mini pies =====
        const investedPct = isFinite(stablePct) ? (100 - Number(stablePct)) : 0;
        const root = getComputedStyle(document.documentElement);
        setPie(document.getElementById('pieStable'), stablePct, root.getPropertyValue('--accent'), root.getPropertyValue('--secondary'), `${Math.round(stablePct)}%`);
        setText('legendStable', `(${Math.round(stablePct)}%)`);
        setText('legendInvested', `(${Math.round(investedPct)}%)`);

        const g1 = Number(data.treasuryGen1);
        const g2 = Number(data.treasuryGen2);
        const totalG = (isFinite(g1) && isFinite(g2) && (g1+g2>0)) ? (g1 + g2) : null;
        let gen1Pct = 90, gen2Pct = 10; // fallback
        if(totalG){ gen1Pct = g1/totalG*100; gen2Pct = g2/totalG*100; }
        setPie(document.getElementById('pieGen'), gen1Pct, root.getPropertyValue('--primary'), root.getPropertyValue('--danger'), `${Math.round(gen1Pct)}%`);
        setText('legendGen1', `(${Math.round(gen1Pct)}%)`);
        setText('legendGen2', `(${Math.round(gen2Pct)}%)`);

        // ===== Footnotes =====
        setText('footUpdated', data.lastUpdated ?? '‚Äî');
        setText('marketUpdated', data.lastUpdated ?? '‚Äî');
        setText('footSol', fmtUsdPlain(data.solPrice));

      } catch (e) {
        console.error('Error loading data.json', e);
      }
    }

    fetchNFTData();
  </script>
</body>
</html>
