<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="Torrino DAO NFT dashboard with treasury highlights, activity stats, member tools, and market links." />
  <title>Torrino DAO NFT Dashboard</title>

  <!-- Typography -->
  <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;600;700&family=Space+Grotesk:wght@500;600;700&family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet" />

  <style>
    :root{
      --bg:#0a0f14;
      --bg-2:#0f1622;
      --panel: rgba(12,20,28,.78);
      --panel-strong: rgba(15,26,36,.9);
      --border: rgba(111,227,255,.2);
      --txt:#eef4f6;
      --muted:#a7b9c4;
      --primary:#5ad1ff;
      --secondary:#8c5bff;
      --accent:#4ce5d2;
      --warning:#ffcc00;
      --success:#00d38d;
      --danger:#ff5c7a;
      --radius:18px;
      --shadow: 0 18px 40px rgba(0,0,0,.35), 0 0 0 2px var(--border) inset;
      --outline: 2px;
      --font-body: "Manrope", system-ui, -apple-system, sans-serif;
      --font-display: "Space Grotesk", system-ui, -apple-system, sans-serif;
    }

    *{ box-sizing: border-box }
    html,body{ height:100% }

    body{
      margin:0;
      font-family: var(--font-body);
      color: var(--txt);
      background: var(--bg);
      overflow-x:hidden;
      letter-spacing:.2px;
    }

    .bg{
      position: fixed; inset:0; pointer-events:none; z-index:0;
      background:
        radial-gradient(1200px 600px at 10% 0%, rgba(76,229,210,.18), transparent 65%),
        radial-gradient(900px 600px at 90% 10%, rgba(140,91,255,.22), transparent 70%),
        linear-gradient(180deg, var(--bg) 0%, #0c141c 35%, #0a1016 100%);
    }
    .bg__glow{
      position:absolute; border-radius:50%; mix-blend-mode:screen; opacity:.8;
      animation: float 18s ease-in-out infinite alternate;
    }
    .bg__glow--one{
      width:620px; height:620px;
      background: radial-gradient(circle at 30% 30%, rgba(76,229,210,.32), transparent 65%);
      top:-220px; left:-120px;
    }
    .bg__glow--two{
      width:540px; height:540px;
      background: radial-gradient(circle at 70% 30%, rgba(140,91,255,.25), transparent 60%);
      bottom:-220px; right:-120px; animation-delay:-6s;
    }
    .bg__glow--three{
      width:420px; height:420px;
      background: radial-gradient(circle at 50% 50%, rgba(90,209,255,.2), transparent 60%);
      top:40%; right:10%; animation-delay:-12s;
    }
    .bg__stars{
      position:absolute; inset:0;
      background-image:
        radial-gradient(1px 1px at 20% 30%, rgba(255,255,255,.25) 45%, transparent 46%),
        radial-gradient(1px 1px at 80% 20%, rgba(255,255,255,.2) 45%, transparent 46%),
        radial-gradient(1px 1px at 40% 70%, rgba(255,255,255,.22) 45%, transparent 46%),
        radial-gradient(1px 1px at 70% 60%, rgba(255,255,255,.18) 45%, transparent 46%),
        radial-gradient(1px 1px at 10% 80%, rgba(255,255,255,.14) 45%, transparent 46%);
      opacity:.35;
    }
    .bg__grid{
      position:absolute; inset:0;
      background-image:
        linear-gradient(rgba(120,200,255,.05) 1px, transparent 1px),
        linear-gradient(90deg, rgba(120,200,255,.05) 1px, transparent 1px);
      background-size: 48px 48px;
      mask-image: radial-gradient(900px 500px at 50% 10%, rgba(0,0,0,.7), transparent 75%);
      opacity:.5;
    }
    .bg__network{
      position:absolute; inset:-10%;
      background:
        radial-gradient(600px 400px at 20% 30%, rgba(76,229,210,.12), transparent 70%),
        radial-gradient(700px 420px at 80% 60%, rgba(90,209,255,.12), transparent 70%),
        radial-gradient(500px 360px at 60% 20%, rgba(140,91,255,.1), transparent 70%);
      animation: networkDrift 22s ease-in-out infinite alternate;
      opacity:.6;
    }
    .bg__canvas{
      position:absolute; inset:0; width:100%; height:100%;
      opacity:.15; mix-blend-mode:screen;
    }

    @keyframes float{
      from{ transform: translate3d(0,0,0) scale(1); }
      to{ transform: translate3d(0,-12px,0) scale(1.02); }
    }
    @keyframes networkDrift{
      from{ transform: translate3d(0,0,0) scale(1); }
      to{ transform: translate3d(0,-18px,0) scale(1.02); }
    }

    .wrapper{ position: relative; z-index:1; max-width:1200px; margin: 36px auto 80px; padding: 0 18px; }

    /* Header */
    .header{ display:flex; align-items:center; justify-content:space-between; gap:16px; margin-bottom: 20px; }

    .brand{ display:flex; align-items:center; gap:14px; }
    .brand img{
      width:64px; height:auto; object-fit:contain; display:block;
      border-radius:0;
      filter: drop-shadow(0 6px 18px rgba(0,224,255,.25));
    }
    .brand .title{ display:flex; flex-direction:column; }
    .brand h1{ margin:0; font-size: clamp(20px, 3.2vw, 28px); font-weight:800; letter-spacing:.3px;
      font-family: var(--font-display);
      background: linear-gradient(90deg, var(--primary), var(--secondary), var(--accent));
      -webkit-background-clip: text; background-clip: text; color: transparent; }
    .brand small{ color: var(--muted); margin-top:2px; font-weight:500; }

    .top-links{ display:flex; align-items:center; flex-wrap:wrap; gap:10px; }
    .chip, .icon-btn{
      display:inline-flex; align-items:center; gap:8px; padding:10px 12px; text-decoration:none; color: var(--txt);
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border: var(--outline) solid var(--border); border-radius: 14px; box-shadow: var(--shadow);
      transition: transform .15s ease, border-color .2s ease, box-shadow .2s ease, background .2s ease;
      backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(8px); font-weight:600; font-size: 14px;
    }
    .chip:hover, .icon-btn:hover{ transform: translateY(-1px); border-color: rgba(255,255,255,.28);
      box-shadow: 0 12px 30px rgba(0,224,255,.12), 0 0 0 2px rgba(255,255,255,.12) inset; }
    .icon-btn{ width:42px; height:42px; padding:0; justify-content:center; }
    .icon-btn img{ width:20px; height:20px; filter: saturate(1.1) brightness(1.05) }
    .icon-btn img.x-icon{ filter: invert(1) brightness(1.2) !important; }
    .back-chip{
      padding:10px 16px; font-weight:700; letter-spacing:.2px;
      background: linear-gradient(135deg, rgba(24,120,94,.9), rgba(42,86,156,.9));
      border-color: rgba(180,255,230,.35);
      box-shadow: 0 14px 34px rgba(16,188,162,.18), inset 0 0 0 1px rgba(255,255,255,.06);
    }
    .back-chip:hover{
      background: linear-gradient(135deg, rgba(32,150,114,.95), rgba(66,120,196,.95));
    }
    .chip-stack{
      flex-direction:column; align-items:flex-start; gap:2px; padding:10px 14px; line-height:1.1;
    }
    .chip-stack .chip-title{ font-weight:700; }
    .chip-stack .chip-sub{ font-size:11px; color:var(--muted); font-weight:600; }

    /* Panels & sections */
    .section{
      padding: 18px; border-radius: var(--radius);
      background: linear-gradient(180deg, rgba(12,20,28,.72), rgba(12,20,28,.45));
      border: var(--outline) solid var(--border);
      box-shadow: var(--shadow), 0 0 0 1px rgba(76,229,210,.08) inset;
      backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); margin-top:18px;
    }
    .section h2{ margin: 4px 0 14px; font-size: clamp(18px, 2.2vw, 22px); font-weight:800; letter-spacing:.2px;
      font-family: var(--font-display); }
    .eyebrow{ display:inline-flex; align-items:center; gap:8px; font-size:12px; font-weight:700; text-transform:uppercase; letter-spacing:.18em; color: var(--accent); }

    /* NEW: Section header with right-aligned actions */
    .section-header{
      display:flex; align-items:flex-end; justify-content:space-between;
      gap:14px; margin-bottom: 10px; flex-wrap:wrap;
    }
    .section-header .title-stack{ display:flex; flex-direction:column; }
    .section-header .actions{ display:flex; align-items:center; gap:10px; }

    /* Composite panel */
    .panel{ border: var(--outline) solid var(--border); border-radius:16px; box-shadow: var(--shadow), 0 0 0 1px rgba(76,229,210,.08) inset;
            background: linear-gradient(180deg, rgba(15,26,36,.78), rgba(12,20,28,.48)); padding:16px; }
    .composite-grid{ display:grid; grid-template-columns: 1fr; gap:16px; align-items:center; }
    .composite-grid .left{ min-width:0 }
    .composite-grid .right{ min-width:0 }
    .metrics{ display:grid; grid-template-columns: 1fr; gap:10px; }
    .metric{ padding:12px; border-radius:12px; border: var(--outline) solid var(--border); background: rgba(255,255,255,.02); }
    .metric--gold{
      border-color: rgba(246,196,83,.55);
      animation: goldPulse 6s ease-in-out infinite;
      box-shadow:
        0 0 10px rgba(246,196,83,.18),
        0 0 0 1px rgba(246,196,83,.2) inset;
    }
    @keyframes goldPulse{
      0%{
        box-shadow:
          0 0 10px rgba(246,196,83,.14),
          0 0 0 1px rgba(246,196,83,.18) inset;
        border-color: rgba(246,196,83,.45);
      }
      50%{
        box-shadow:
          0 0 28px rgba(246,196,83,.22),
          0 0 0 1px rgba(246,196,83,.3) inset;
        border-color: rgba(255,214,112,.82);
      }
      100%{
        box-shadow:
          0 0 10px rgba(246,196,83,.14),
          0 0 0 1px rgba(246,196,83,.18) inset;
        border-color: rgba(246,196,83,.45);
      }
    }
    .m-label{ color: var(--muted); font-size:12px; font-weight:700; text-transform:uppercase; letter-spacing:.06em }
    .m-value{ margin-top:6px; font-family: 'JetBrains Mono', ui-monospace; font-weight:800; font-size: clamp(18px, 2.6vw, 22px) }
    .m-sub{ margin-top:4px; color: var(--muted); font-size:12px }
    @media(min-width: 980px){
      .composite-grid{ grid-template-columns: 1.1fr .9fr }
      .metrics{ grid-template-columns: 1fr }
      .composite-grid .right{ border-left: 1px solid var(--border); padding-left:16px }
    }

    /* Discounts & buttons */
    .buy-actions{ display:flex; flex-wrap:wrap; gap:10px; margin-top:12px; }
    .btn{ appearance:none; border:none; cursor:pointer; font-weight:800; letter-spacing:.2px; padding:12px 16px; border-radius:12px;
      background: linear-gradient(90deg, var(--primary), var(--accent)); color:#0b1220; box-shadow: 0 10px 26px rgba(0,224,255,.22);
      text-decoration:none; display:inline-flex; align-items:center; gap:8px; transition: transform .12s ease, filter .12s ease, box-shadow .12s ease; }
    .btn:hover{ transform: translateY(-1px); filter:brightness(1.02) }

    .note{ color: var(--muted); font-size: 14px; line-height:1.6; }
    .highlight{ color: var(--warning); font-weight:700 }

    /* Charts grid */
    .charts{ display:grid; gap:12px; margin-top:8px; grid-template-columns: 1fr; }
    @media (min-width: 980px){ .charts{ grid-template-columns: 1fr 1fr; } .charts .chart.full{ grid-column: 1 / -1; } }
    .chart{ border:var(--outline) solid var(--border); border-radius:16px; overflow:hidden; background: #0e1526; box-shadow: var(--shadow); }
    .chart iframe{ display:block; width:100%; height:440px; border:0 }

    /* Update/footnote */
    .footnote{ margin-top: 8px; font-size: 12px; color: var(--muted); display:flex; flex-wrap:wrap; gap:16px; }

    /* Skeleton loading */
    .skeleton{ position: relative; background: linear-gradient(90deg, rgba(255,255,255,.08), rgba(255,255,255,.04), rgba(255,255,255,.08)); background-size: 200% 100%; animation: shine 1.1s linear infinite; color: transparent !important; border-radius: 8px; display:inline-block; line-height:1.1; }
    @keyframes shine{ 0% { background-position: 200% 0 } 100% { background-position: -200% 0 } }

    /* Two-up grid helper */
    .row{ display:grid; gap:12px; grid-template-columns:1fr; }
    @media(min-width: 900px){ .row{ grid-template-columns: 1fr 1fr } }

    a{ color: var(--primary) }

    /* ==== MINI PIE CHARTS ==== */
    .mini-pie{ display:flex; align-items:center; gap:14px; padding:12px; border-radius:14px; border:var(--outline) solid var(--border); box-shadow: var(--shadow);
      background: linear-gradient(180deg, rgba(255,255,255,.045), rgba(255,255,255,.02)); }
    .pie{ width:92px; height:92px; border-radius:50%; position:relative; flex:0 0 auto; background:#0b1220; }
    .pie::after{ content:""; position:absolute; inset:12px; border-radius:50%; background:#0e1526; display:block; }
    .pie-center-btn{
      position:absolute; inset:0; margin:auto; width:54px; height:54px; border-radius:50%;
      border: 1px solid rgba(255,255,255,.18);
      background: rgba(12,20,28,.9);
      color: var(--txt); font-size:10px; font-weight:700; text-transform:uppercase; letter-spacing:.08em;
      display:flex; align-items:center; justify-content:center; z-index:2; cursor:pointer;
      transition: transform .15s ease, box-shadow .2s ease, border-color .2s ease;
      box-shadow: 0 8px 18px rgba(0,0,0,.35);
    }
    .pie-center-btn:hover{
      transform: translateY(-1px) scale(1.02);
      border-color: rgba(76,229,210,.6);
      box-shadow: 0 12px 24px rgba(76,229,210,.18);
    }
    .legend{ display:flex; flex-direction:column; gap:6px; font-size:13px; }
    .legend b{ font-weight:800 }
    .badge{ display:inline-flex; align-items:center; gap:6px; }
    .dot{ width:10px; height:10px; border-radius:50%; display:inline-block; }

    /* Footer */
    footer{ text-align:center }
    footer small{ color: var(--muted) }

    /* ====== Modal styles for logs ====== */
    .modal{
      position: fixed; inset:0; display:none; place-items:center; z-index: 50;
      background: radial-gradient(1000px 600px at 50% -10%, rgba(0,224,255,.12), transparent 70%),
                  rgba(5,8,15,.66);
      backdrop-filter: blur(4px);
    }
    .modal.open{ display:grid; }
    .modal-card{
      width:min(980px, 94vw); max-height:min(86vh, 840px);
      border-radius: 18px;
      border: var(--outline) solid var(--border);
      box-shadow: 0 24px 60px rgba(0,0,0,.5), 0 0 0 2px rgba(255,255,255,.06) inset;
      background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.035));
      overflow:hidden;
      display:flex; flex-direction:column;
    }
    .modal-header{
      padding:14px 16px; display:flex; align-items:center; justify-content:space-between; gap:10px;
      border-bottom: 1px solid var(--border);
      background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.02));
    }
    .modal-title{
      font-weight:800; letter-spacing:.25px; font-size:16px;
      display:flex; align-items:center; gap:10px;
    }
    .close-btn{
      appearance:none; border:none; background:transparent; color:var(--txt); cursor:pointer;
      width:36px; height:36px; border-radius:10px;
      display:inline-grid; place-items:center;
    }
    .close-btn:hover{ background: rgba(255,255,255,.08) }

    .modal-tools{
      display:flex; align-items:center; gap:8px; flex-wrap:wrap;
    }
    .tool-btn{
      appearance:none; border:none; cursor:pointer; font-weight:700; padding:8px 10px; border-radius:10px;
      background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.04));
      border: var(--outline) solid var(--border); color: var(--txt);
    }
    .tool-btn:hover{ transform: translateY(-1px); box-shadow: 0 8px 20px rgba(0,224,255,.14) }

    .modal-body{ padding: 0; overflow:auto; background:#0a0f1f; }
    .logview{
      margin:0; padding:16px; font-family:'JetBrains Mono', ui-monospace, monospace; font-size:12.5px; line-height:1.5;
      white-space:pre-wrap; word-break:break-word; color:#e7e9ee;
      min-height: 300px; max-height: 60vh;
      background:
        linear-gradient(180deg, rgba(0,0,0,.0), rgba(0,0,0,.0)),
        repeating-linear-gradient(0deg, rgba(255,255,255,.04) 0px, rgba(255,255,255,.04) 1px, transparent 1px, transparent 22px);
    }
    .modal-footer{
      display:flex; align-items:center; justify-content:space-between; gap:10px; padding:10px 14px; color:var(--muted);
      border-top: 1px solid var(--border); background: rgba(255,255,255,.03);
      font-size:12px;
    }

    /* ====== Mini modal for treasury breakdown ====== */
    .mini-modal{
      position: fixed; inset:0; display:none; place-items:center; z-index: 55;
      background: rgba(6,10,16,.55);
      backdrop-filter: blur(3px);
    }
    .mini-modal.open{ display:grid; }
    .mini-modal-card{
      width:min(460px, 92vw);
      border-radius: 16px;
      border: var(--outline) solid var(--border);
      box-shadow: 0 20px 50px rgba(0,0,0,.5), 0 0 0 2px rgba(255,255,255,.06) inset;
      background: linear-gradient(180deg, rgba(12,20,28,.9), rgba(12,20,28,.7));
      overflow:hidden;
    }
    .mini-modal-header{
      display:flex; align-items:center; justify-content:space-between;
      padding: 12px 14px; border-bottom: 1px solid var(--border);
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
    }
    .mini-modal-title{ font-weight:800; font-size:14px; letter-spacing:.3px; font-family: var(--font-display); }
    .mini-modal-body{ padding: 12px 14px; }
    .mini-list{ display:flex; flex-direction:column; gap:8px; font-size:14px; }
    .mini-row{ display:flex; align-items:center; justify-content:space-between; gap:8px; }
    .mini-label{ display:flex; align-items:center; gap:6px; font-weight:600; }
    .mini-value{ font-family: 'JetBrains Mono', ui-monospace; font-weight:700; }
    .mini-pct{ color: var(--muted); font-weight:600; margin-left:6px; font-size:12px; }
    .mini-note{ display:block; margin-top:10px; color: var(--muted); font-size:12px; }

    .switch{
      display:inline-flex; align-items:center; gap:8px; padding:6px 8px; border-radius:10px;
      border: var(--outline) solid var(--border); background: rgba(255,255,255,.02);
      user-select:none;
    }
    .switch input{ accent-color: var(--accent); width:16px; height:16px }

    .raw-link{ text-decoration:none; }
    .footer-credit a{ color:#4aa3ff; text-decoration: underline; text-underline-offset: 3px; }
  </style>
</head>
<body>
  <div class="bg" aria-hidden="true">
    <div class="bg__glow bg__glow--one"></div>
    <div class="bg__glow bg__glow--two"></div>
    <div class="bg__glow bg__glow--three"></div>
    <div class="bg__grid"></div>
    <div class="bg__network"></div>
    <canvas class="bg__canvas" aria-hidden="true"></canvas>
    <div class="bg__stars"></div>
  </div>

  <div class="wrapper">
    <!-- HEADER -->
    <header class="header">
      <div class="brand">
        <img src="torrino-dao.png" alt="Torrino DAO Logo" />
        <div class="title">
          <h1>Torrino DAO ‚Äî NFT Dashboard</h1>
          <small>On-chain analytics ‚Ä¢ NFTs ‚Ä¢ Treasury</small>
        </div>
      </div>

      <nav class="top-links">
        <a class="chip back-chip" href="https://torrino.space" target="_blank" rel="noopener noreferrer" aria-label="Back to torrino.space">
          &larr; Back to torrino.space
        </a>
        <a class="chip back-chip" href="https://torrino.space" target="_blank" rel="noopener noreferrer" aria-label="Back to Torrino Hub">
          &larr; Back to Torrino Hub
        </a>
        <a class="icon-btn" href="https://twitter.com/Torrino_DAO" target="_blank" rel="noopener noreferrer" aria-label="Twitter (X)">
          <img class="x-icon" src="https://cdn-icons-png.flaticon.com/512/5968/5968958.png" alt="Twitter (X)" />
        </a>
      </nav>
    </header>

    <!-- TREASURY & MARKET -->
    <section class="section" aria-labelledby="overview">
      <div class="section-header">
        <div class="title-stack">
          <div class="eyebrow">Overview</div>
          <h2 id="overview">Treasury &amp; Market</h2>
        </div>
        <div class="actions">
          <button class="chip" id="openLogsBtn" type="button" aria-haspopup="dialog" aria-controls="logsModal" title="View calculation logs">
            üëÅÔ∏è Treasury Overview
          </button>
          <a class="chip chip-stack" href="https://solscan.io/account/EKjb5grMX19c3cAZa5LQjqksDpqqVLTGZrswh79WkPdD" target="_blank" rel="noopener" aria-label="Treasury Address (Solscan)">
            <span class="chip-title">Treasury Address (Solscan)</span>
            <span class="chip-sub">EKjb‚Ä¶WkPdD</span>
          </a>
          <noscript><a class="chip" href="logs/latest.txt" target="_blank" rel="noopener">Open raw logs</a></noscript>
        </div>
      </div>

      <!-- CARD 1: Treasury Composition + metrics -->
      <div class="panel composite" style="margin-top:10px">
        <div class="composite-grid">
          <div class="left">
            <div class="label" style="text-transform:uppercase; letter-spacing:.06em; font-size:12px; color:var(--muted); font-weight:700;">Treasury Composition (Stable vs Invested)</div>
            <div class="mini-pie" style="margin-top:10px">
              <div class="pie" id="pieStable">
                <button class="pie-center-btn" id="treasuryBreakdownBtn" type="button" aria-haspopup="dialog" aria-controls="treasuryModal" title="Hover or tap for breakdown">
                  Tap for details
                </button>
              </div>
              <div class="legend">
                <b>Allocation</b>
                <div class="badge"><span class="dot" style="background:var(--accent)"></span> Stable Coins <span id="legendStable" style="margin-left:6px; font-weight:700"></span></div>
                <div class="badge"><span class="dot" style="background:var(--secondary)"></span> Invested / Volatile <span id="legendInvested" style="margin-left:6px; font-weight:700"></span></div>
              </div>
            </div>
          </div>

          <div class="right metrics">
            <div class="metric metric--gold">
              <div class="m-label">Total Treasury</div>
              <div class="m-value" id="treasuryValue"><span class="skeleton">&nbsp;</span></div>
              <div class="m-sub">100%</div>
            </div>
            <div class="metric">
              <div class="m-label">Stable Protected Capital</div>
              <div class="m-value"><span id="stableValue"><span class="skeleton">&nbsp;</span></span></div>
              <div class="m-sub">= <span id="stablePercentage"><span class="skeleton">&nbsp;</span></span>% of treasury</div>
            </div>
          </div>
        </div>
      </div>

      <!-- CARD 2: Treasury by Generation (Value) -->
      <div class="panel composite" style="margin-top:12px">
        <div class="composite-grid">
          <div class="left">
            <div class="label" style="text-transform:uppercase; letter-spacing:.06em; font-size:12px; color:var(--muted); font-weight:700;">Treasury by Generation (Value)</div>
            <div class="mini-pie" style="margin-top:10px">
              <div class="pie" id="pieGen"></div>
              <div class="legend">
                <b>Value Allocation</b>
                <div class="badge"><span class="dot" style="background:var(--primary)"></span> 90% Treasury Allocation &ndash; Gen 1 Torrino Dao</div>
                <div class="badge"><span class="dot" style="background:var(--danger)"></span> 10% Treasury Allocation &ndash; Gen 2 Solnauta</div>
              </div>
            </div>
          </div>

          <div class="right metrics">
            <div class="metric">
              <div class="m-label">Gen 1 Treasury Value</div>
              <div class="m-value" id="treasuryGen1"><span class="skeleton">&nbsp;</span></div>
              <div class="m-sub">‚âà <span id="legendGen1Pct"></span></div>
            </div>
            <div class="metric">
              <div class="m-label">Gen 2 Treasury Value</div>
              <div class="m-value" id="treasuryGen2"><span class="skeleton">&nbsp;</span></div>
              <div class="m-sub">‚âà <span id="legendGen2Pct"></span></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Footnote -->
      <div class="footnote">
        <div>Current SOL Price: <strong id="footSol"><span class="skeleton">&nbsp;</span></strong></div>
        <div>Last updated: <strong id="footUpdated"><span class="skeleton">&nbsp;</span></strong></div>
      </div>
    </section>

    <!-- NFT REAL VALUE -->
    <section class="section" aria-labelledby="nft-values">
      <div class="eyebrow">NFT</div>
      <h2 id="nft-values">Current NFT Real Value</h2>

      <div class="row">
        <div>
          <div class="stat">
            <div class="label">Torrino DAO (Gen 1 ‚Äî 500 pcs)</div>
            <div class="value">
              <span id="nftGen1Value"><span class="skeleton">&nbsp;&nbsp;</span></span>
              <span class="sub">(<span id="nftGen1ValueSol"><span class="skeleton">&nbsp;</span></span>)</span>
            </div>
          </div>
        </div>
        <div>
          <div class="stat">
            <div class="label">Solnauta (Gen 2 ‚Äî 888 pcs)</div>
            <div class="value">
              <span id="nftGen2Value"><span class="skeleton">&nbsp;&nbsp;</span></span>
              <span class="sub">(<span id="nftGen2ValueSol"><span class="skeleton">&nbsp;</span></span>)</span>
            </div>
          </div>
        </div>
      </div>

      <p class="note" style="margin-top:12px">
        <strong>üì¢ NFT Discount Analysis:</strong><br/>
        Listing prices are compared with the NFT <em>real value</em> based on the treasury. If the listing price is lower than the real value, the NFT is considered discounted and may be a better entry versus the current treasury valuation.
      </p>

      <p class="note">
        <strong>üí° Protected Capital &amp; NFT Value:</strong><br/>
        <em>Protected Capital</em> is the slice of the treasury held in stables (USDC/USDT/USDY) that preserves value regardless of market conditions. Buying a discounted NFT gives exposure to both the volatile part and the protected portion of the treasury: <span class="highlight">high discount + high protected %</span> = upside potential + capital preservation.
      </p>
    </section>

    <!-- DISCOUNTS -->
    <section class="section" aria-labelledby="discounts">
      <div class="eyebrow">Market</div>
      <h2 id="discounts">Discounts on Listed NFTs</h2>

      <div class="row">
        <div>
          <div class="stat">
            <div class="label">üìâ Torrino DAO (Gen 1)</div>
            <div class="value">
              <span id="gen1ListingPrice"><span class="skeleton">&nbsp;&nbsp;</span></span>
            </div>
            <div class="sub">‚û°Ô∏è Difference from real value: <strong><span id="gen1Discount"><span class="skeleton">&nbsp;</span></span>%</strong></div>
            <div class="buy-actions">
              <a class="btn" href="https://www.tensor.trade/trade/torrino_dao" target="_blank" rel="noopener">üõí Buy Torrino DAO</a>
            </div>
          </div>
        </div>

        <div>
          <div class="stat">
            <div class="label">üìâ Solnauta (Gen 2)</div>
            <div class="value">
              <span id="gen2ListingPrice"><span class="skeleton">&nbsp;&nbsp;</span></span>
            </div>
            <div class="sub">‚û°Ô∏è Difference from real value: <strong><span id="gen2Discount"><span class="skeleton">&nbsp;</span></span>%</strong></div>
            <div class="buy-actions">
              <a class="btn" href="https://www.tensor.trade/trade/solnauta" target="_blank" rel="noopener">üõí Buy Solnauta</a>
            </div>
          </div>
        </div>
      </div>

      <div class="footnote">Data source last updated: <strong id="marketUpdated"><span class="skeleton">&nbsp;</span></strong></div>
    </section>

    <!-- CHARTS -->
    <section class="section" aria-labelledby="charts">
      <div class="eyebrow">Analytics</div>
      <h2 id="charts">Treasury Charts</h2>

      <div class="charts">
        <div class="chart">
          <iframe
            src="https://docs.google.com/spreadsheets/d/e/2PACX-1vT84K0e8A5H3P2gI4upLGkArVFHDtXQ5uyDAfZjEHfnYsxGm0uCHwUxfTHr_zzm4jkzhUGMzdox85DT/pubchart?oid=908001184&format=interactive"
            loading="lazy" referrerpolicy="no-referrer" title="Treasury Chart 1">
          </iframe>
        </div>

        <div class="chart">
          <iframe
            src="https://docs.google.com/spreadsheets/d/e/2PACX-1vT84K0e8A5H3P2gI4upLGkArVFHDtXQ5uyDAfZjEHfnYsxGm0uCHwUxfTHr_zzm4jkzhUGMzdox85DT/pubchart?oid=1345237562&format=interactive"
            loading="lazy" referrerpolicy="no-referrer" title="Treasury Chart 2">
          </iframe>
        </div>

        <div class="chart full">
          <iframe
            src="https://docs.google.com/spreadsheets/d/e/2PACX-1vT84K0e8A5H3P2gI4upLGkArVFHDtXQ5uyDAfZjEHfnYsxGm0uCHwUxfTHr_zzm4jkzhUGMzdox85DT/pubchart?oid=1508575723&amp;format=interactive"
            loading="lazy" referrerpolicy="no-referrer" title="Treasury Table / Chart 3">
          </iframe>
        </div>
      </div>
    </section>

    <footer class="section">
      <small class="footer-credit">¬© 2026 Torrino DAO ‚Äî Crafted with passion by HAPPY ‚Äî <a href="https://happydev.fi" target="_blank" rel="noopener">happydev.fi</a></small>
    </footer>
  </div>

  <!-- Treasury Breakdown Modal -->
  <div class="mini-modal" id="treasuryModal" role="dialog" aria-modal="true" aria-labelledby="treasuryTitle" aria-describedby="treasuryDesc">
    <div class="mini-modal-card">
      <div class="mini-modal-header">
        <div class="mini-modal-title" id="treasuryTitle">Treasury Breakdown</div>
        <button class="close-btn" id="closeTreasuryBtn" aria-label="Close">‚úï</button>
      </div>
      <div class="mini-modal-body" id="treasuryDesc">
        <div class="mini-list" id="treasuryList">Loading‚Ä¶</div>
        <small class="mini-note">Source: logs/latest.txt</small>
      </div>
    </div>
  </div>

  <!-- Logs Modal -->
  <div class="modal" id="logsModal" role="dialog" aria-modal="true" aria-labelledby="logsTitle" aria-describedby="logsDesc">
    <div class="modal-card">
      <div class="modal-header">
        <div class="modal-title" id="logsTitle">üßæ Public Treasury Calculation Logs <small style="color:var(--muted); font-weight:600;">(logs/latest.txt)</small></div>
        <div class="modal-tools">
          <button class="tool-btn" id="refreshLogsBtn" type="button">Refresh</button>
          <label class="switch"><input type="checkbox" id="autoRefreshToggle" /> Live refresh</label>
          <label class="switch"><input type="checkbox" id="autoScrollToggle" checked /> Auto-scroll</label>
          <button class="tool-btn" id="copyLogsBtn" type="button">Copy</button>
          <a class="tool-btn raw-link" href="logs/latest.txt" target="_blank" rel="noopener">Open raw</a>
          <button class="close-btn" id="closeLogsBtn" aria-label="Close">‚úï</button>
        </div>
      </div>
      <div class="modal-body" id="logsDesc">
        <pre class="logview" id="logsContent">Loading‚Ä¶</pre>
      </div>
      <div class="modal-footer">
        <div>Source: <code>/logs/latest.txt</code> ‚Ä¢ Updated <span id="logsUpdated">‚Äî</span></div>
        <div style="opacity:.85">Tip: enable <strong>Live refresh</strong> while a run is in progress.</div>
      </div>
    </div>
  </div>

  <script>
    // ===== Formatting helpers =====
    const fmtUsdBig = (v) => {
      const num = Number(v);
      if (isNaN(num)) return String(v);
      const opts = Number.isInteger(num) ? { maximumFractionDigits: 0 } : { maximumFractionDigits: 2 };
      return "$" + num.toLocaleString("en-US", opts) + " USD";
    };
    const fmtUsdPlain = (v) => {
      const num = Number(v);
      if (isNaN(num)) return String(v);
      return "$" + num.toFixed(Number.isInteger(num) ? 0 : 2).replace(/\.00$/, "");
    };
    const fmtNoGroup = (v) => {
      const num = Number(v);
      if (isNaN(num)) return String(v);
      return num.toFixed(Number.isInteger(num) ? 0 : 2).replace(/\.00$/, "");
    };
    const setText = (id, val) => {
      const el = document.getElementById(id);
      if (!el) return; el.textContent = val; el.classList?.remove('skeleton');
    };

    // ===== Mini pie helpers (CSS conic-gradient) =====
    function setPie(el, pct, colorA, colorB){
      if(!el) return;
      const p = Math.max(0, Math.min(100, Number(pct) || 0));
      el.style.background = `conic-gradient(${colorA} 0 ${p}%, ${colorB} 0 ${100}%)`;
    }

    async function fetchNFTData() {
      try {
        const res = await fetch('data.json', { cache: 'no-store' });
        const data = await res.json();

        // Top stats
        setText('treasuryValue', fmtUsdBig(data.treasuryValue));
        setText('stableValue', fmtUsdBig(data.stableValue));
        const stablePct = Number(data.stablePercentage ?? (Number(data.stableValue)/Number(data.treasuryValue)*100));
        setText('stablePercentage', isFinite(stablePct) ? stablePct.toFixed(0) : '‚Äî');

        setText('treasuryGen1', fmtUsdBig(data.treasuryGen1));
        setText('treasuryGen2', fmtUsdBig(data.treasuryGen2));

        // NFT values
        setText('nftGen1Value', fmtUsdPlain(data.nftGen1Value));
        setText('nftGen1ValueSol', `${fmtNoGroup(data.nftGen1ValueSol)} SOL`);
        setText('nftGen2Value', fmtUsdPlain(data.nftGen2Value));
        setText('nftGen2ValueSol', `${fmtNoGroup(data.nftGen2ValueSol)} SOL`);

        // Discounts
        setText('gen1ListingPrice', `${fmtUsdPlain(data.gen1ListingPrice)} (${fmtNoGroup(data.gen1ListingPriceSol)} SOL)`);
        setText('gen1Discount', fmtNoGroup(data.gen1Discount));
        setText('gen2ListingPrice', `${fmtUsdPlain(data.gen2ListingPrice)} (${fmtNoGroup(data.gen2ListingPriceSol)} SOL)`);
        setText('gen2Discount', fmtNoGroup(data.gen2Discount));

        // Pies
        const investedPct = isFinite(stablePct) ? (100 - Number(stablePct)) : 0;
        const root = getComputedStyle(document.documentElement);
        setPie(document.getElementById('pieStable'), stablePct, root.getPropertyValue('--accent'), root.getPropertyValue('--secondary'));
        setText('legendStable', `(${Math.round(stablePct)}%)`);
        setText('legendInvested', `(${Math.round(investedPct)}%)`);

        const g1 = Number(data.treasuryGen1);
        const g2 = Number(data.treasuryGen2);
        const totalG = (isFinite(g1) && isFinite(g2) && (g1+g2>0)) ? (g1 + g2) : null;
        let gen1Pct = 90, gen2Pct = 10; // fallback
        if(totalG){ gen1Pct = g1/totalG*100; gen2Pct = g2/totalG*100; }
        setPie(document.getElementById('pieGen'), gen1Pct, root.getPropertyValue('--primary'), root.getPropertyValue('--danger'));
        setText('legendGen1', `(${Math.round(gen1Pct)}%)`);
        setText('legendGen2', `(${Math.round(gen2Pct)}%)`);
        setText('legendGen1Pct', `(${Math.round(gen1Pct)}%)`);
        setText('legendGen2Pct', `(${Math.round(gen2Pct)}%)`);

        // Footnotes
        setText('footUpdated', data.lastUpdated ?? '‚Äî');
        setText('marketUpdated', data.lastUpdated ?? '‚Äî');
        setText('footSol', fmtUsdPlain(data.solPrice));

      } catch (e) {
        console.error('Error loading data.json', e);
      }
    }

    fetchNFTData();

    // ===== Treasury breakdown (from latest logs) =====
    const breakdownBtn = document.getElementById('treasuryBreakdownBtn');
    const treasuryModal = document.getElementById('treasuryModal');
    const treasuryList = document.getElementById('treasuryList');
    const closeTreasuryBtn = document.getElementById('closeTreasuryBtn');
    const hoverCapable = window.matchMedia('(hover: hover)').matches;
    const coarsePointer = window.matchMedia('(pointer: coarse)').matches;
    const isTouchDevice = ('ontouchstart' in window) || (navigator.maxTouchPoints > 0);
    const isNarrow = window.matchMedia('(max-width: 900px)').matches;
    let treasuryCloseTimer = null;

    const fmtUsdShort = (v) => {
      if (!isFinite(v)) return '‚Äî';
      return '$' + Number(v).toLocaleString('en-US', { maximumFractionDigits: 2 });
    };
    const fmtPct = (v) => isFinite(v) ? `${v.toFixed(1)}%` : '‚Äî';

    function parseTreasurySummary(raw){
      const start = raw.indexOf('üìù **Treasury Summary**:');
      if (start === -1) return null;
      const lines = raw.slice(start).split('\n');
      const entries = [];
      const pick = (label, icon, line) => {
        const match = line.match(/\$([0-9.,]+)/);
        if (!match) return;
        const value = Number(match[1].replace(/,/g, ''));
        if (!isFinite(value)) return;
        entries.push({ label, icon, value });
      };
      for (const line of lines) {
        if (line.includes('üí∞ Tokens (ex-stable):')) pick('Tokens', 'üí∞', line);
        if (line.includes('üí∞ Tokens:')) pick('Tokens', 'üí∞', line);
        if (line.includes('üíµ Stablecoins:')) pick('Stablecoins', 'üíµ', line);
        if (line.includes('üîπ Staking:')) pick('Staking', 'üîπ', line);
        if (line.includes('üé® NFT:')) pick('NFT', 'üé®', line);
        if (line.includes('üè¶ Total treasury value')) break;
      }
      if (!entries.length) return null;
      const total = entries.reduce((sum, e) => sum + e.value, 0);
      return { entries, total };
    }

    function renderTreasuryBreakdown(summary){
      if (!summary) {
        treasuryList.textContent = 'Treasury summary not found in logs.';
        return;
      }
      const { entries, total } = summary;
      treasuryList.innerHTML = '';
      entries.forEach((entry) => {
        const row = document.createElement('div');
        row.className = 'mini-row';
        const label = document.createElement('div');
        label.className = 'mini-label';
        label.textContent = `${entry.icon} ${entry.label}`;
        const value = document.createElement('div');
        value.className = 'mini-value';
        const pct = total > 0 ? (entry.value / total) * 100 : NaN;
        value.innerHTML = `${fmtUsdShort(entry.value)} <span class="mini-pct">(${fmtPct(pct)})</span>`;
        row.appendChild(label);
        row.appendChild(value);
        treasuryList.appendChild(row);
      });
    }

    async function loadTreasuryBreakdown(){
      try{
        const res = await fetch('logs/latest.txt?ts=' + Date.now(), { cache: 'no-store' });
        if(!res.ok){
          treasuryList.textContent = 'logs/latest.txt not found yet. Run the workflow once to generate it.';
          return;
        }
        const txt = await res.text();
        renderTreasuryBreakdown(parseTreasurySummary(txt));
      }catch(err){
        treasuryList.textContent = 'Error loading logs/latest.txt: ' + err;
      }
    }

    function openTreasuryModal(){
      treasuryModal.classList.add('open');
      loadTreasuryBreakdown();
    }
    function closeTreasuryModal(){
      treasuryModal.classList.remove('open');
    }
    function scheduleTreasuryClose(){
      if (treasuryCloseTimer) clearTimeout(treasuryCloseTimer);
      treasuryCloseTimer = setTimeout(closeTreasuryModal, 180);
    }

    const prefersTap = !hoverCapable || coarsePointer || isTouchDevice || isNarrow;
    if (breakdownBtn) breakdownBtn.textContent = 'Tap for details';
    if (!prefersTap) {
      breakdownBtn?.addEventListener('mouseenter', openTreasuryModal);
      breakdownBtn?.addEventListener('mouseleave', scheduleTreasuryClose);
      treasuryModal?.addEventListener('mouseenter', () => {
        if (treasuryCloseTimer) clearTimeout(treasuryCloseTimer);
      });
      treasuryModal?.addEventListener('mouseleave', scheduleTreasuryClose);
    }
    breakdownBtn?.addEventListener('click', openTreasuryModal);
    breakdownBtn?.addEventListener('touchend', (e) => {
      e.preventDefault();
      openTreasuryModal();
    }, { passive: false });
    closeTreasuryBtn?.addEventListener('click', closeTreasuryModal);
    treasuryModal?.addEventListener('click', (e) => {
      if (e.target === treasuryModal) closeTreasuryModal();
    });

    // ===== Logs modal controller =====
    const openBtn = document.getElementById('openLogsBtn');
    const modal = document.getElementById('logsModal');
    const closeBtn = document.getElementById('closeLogsBtn');
    const refreshBtn = document.getElementById('refreshLogsBtn');
    const copyBtn = document.getElementById('copyLogsBtn');
    const logsContent = document.getElementById('logsContent');
    const logsUpdated = document.getElementById('logsUpdated');
    const autoScrollToggle = document.getElementById('autoScrollToggle');
    const autoRefreshToggle = document.getElementById('autoRefreshToggle');

    let refreshTimer = null;

    function escapeHtml(str){
      return str.replace(/[&<>]/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;'}[c]));
    }

    async function loadLogs(){
      try{
        const res = await fetch('logs/latest.txt?ts=' + Date.now(), { cache: 'no-store' });
        if(!res.ok){
          logsContent.textContent = 'logs/latest.txt not found yet. Run the workflow once to generate it.';
          logsUpdated.textContent = '‚Äî';
          return;
        }
        const txt = await res.text();
        logsContent.innerHTML = escapeHtml(txt);
        logsUpdated.textContent = new Date().toLocaleString();
        if(autoScrollToggle.checked){
          logsContent.parentElement.scrollTop = logsContent.parentElement.scrollHeight;
        }
      }catch(err){
        logsContent.textContent = 'Error loading logs/latest.txt: ' + err;
        logsUpdated.textContent = '‚Äî';
      }
    }

    function openModal(){
      modal.classList.add('open');
    loadLogs();
    if(autoRefreshToggle.checked){
      startAutoRefresh();
    }
      modal.addEventListener('click', backdropCloseHandler);
      document.addEventListener('keydown', escHandler);
    }

    function closeModal(){
      modal.classList.remove('open');
      stopAutoRefresh();
      modal.removeEventListener('click', backdropCloseHandler);
      document.removeEventListener('keydown', escHandler);
    }

    function backdropCloseHandler(e){ if(e.target === modal){ closeModal(); } }
    function escHandler(e){ if(e.key === 'Escape'){ closeModal(); } }

    function startAutoRefresh(){ stopAutoRefresh(); refreshTimer = setInterval(loadLogs, 5000); }
    function stopAutoRefresh(){ if(refreshTimer){ clearInterval(refreshTimer); refreshTimer = null; } }

    openBtn?.addEventListener('click', openModal);
    closeBtn?.addEventListener('click', closeModal);
    refreshBtn?.addEventListener('click', loadLogs);
    autoRefreshToggle?.addEventListener('change', (e)=> e.target.checked ? startAutoRefresh() : stopAutoRefresh());
    copyBtn?.addEventListener('click', async ()=>{
      try{
        const text = logsContent.textContent || '';
        await navigator.clipboard.writeText(text);
        copyBtn.textContent = 'Copied!';
        setTimeout(()=> copyBtn.textContent = 'Copy', 1200);
      }catch(_){}
    });

    // ===== Animated background network =====
    const bgCanvas = document.querySelector('.bg__canvas');
    if (bgCanvas) {
      const ctx = bgCanvas.getContext('2d');
      let width = 0;
      let height = 0;
      let nodes = [];
      const nodeCount = 36;
      const maxDist = 140;
      const speed = 0.18;

      const resize = () => {
        width = bgCanvas.parentElement?.offsetWidth || window.innerWidth;
        height = bgCanvas.parentElement?.offsetHeight || window.innerHeight;
        bgCanvas.width = Math.floor(width * devicePixelRatio);
        bgCanvas.height = Math.floor(height * devicePixelRatio);
        bgCanvas.style.width = `${width}px`;
        bgCanvas.style.height = `${height}px`;
        ctx.setTransform(devicePixelRatio, 0, 0, devicePixelRatio, 0, 0);
      };

      const initNodes = () => {
        nodes = Array.from({ length: nodeCount }).map(() => ({
          x: Math.random() * width,
          y: Math.random() * height,
          vx: (Math.random() - 0.5) * speed,
          vy: (Math.random() - 0.5) * speed,
        }));
      };

      const draw = () => {
        ctx.clearRect(0, 0, width, height);
        ctx.lineWidth = 1;
        for (let i = 0; i < nodes.length; i++) {
          const n = nodes[i];
          for (let j = i + 1; j < nodes.length; j++) {
            const m = nodes[j];
            const dx = n.x - m.x;
            const dy = n.y - m.y;
            const dist = Math.hypot(dx, dy);
            if (dist < maxDist) {
              const alpha = 1 - dist / maxDist;
              ctx.strokeStyle = `rgba(76, 229, 210, ${alpha * 0.25})`;
              ctx.beginPath();
              ctx.moveTo(n.x, n.y);
              ctx.lineTo(m.x, m.y);
              ctx.stroke();
            }
          }
        }
        for (const n of nodes) {
          ctx.fillStyle = 'rgba(90, 209, 255, 0.5)';
          ctx.beginPath();
          ctx.arc(n.x, n.y, 2, 0, Math.PI * 2);
          ctx.fill();
        }
      };

      const step = () => {
        for (const n of nodes) {
          n.x += n.vx;
          n.y += n.vy;
          if (n.x < -40) n.x = width + 40;
          if (n.x > width + 40) n.x = -40;
          if (n.y < -40) n.y = height + 40;
          if (n.y > height + 40) n.y = -40;
        }
        draw();
        requestAnimationFrame(step);
      };

      const prefersReduced = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
      resize();
      initNodes();
      if (!prefersReduced) {
        requestAnimationFrame(step);
      } else {
        draw();
      }
      window.addEventListener('resize', () => {
        resize();
        initNodes();
      });
    }
  </script>
</body>
</html>
